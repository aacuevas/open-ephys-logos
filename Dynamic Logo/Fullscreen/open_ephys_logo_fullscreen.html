<!DOCTYPE html>
<html>
<head>
<!-- Load the Paper.js library -->
<script type="text/javascript" src="paper.js"></script>
<!-- Load external PaperScript and associate it with myCanvas -->
<script type="text/paperscript" canvas="myCanvas">
 
var background = new Path.Rectangle(new Point(0, 0), new Size(870, 374));
background.fillColor = 'white';

/*
    ------------------------------------------------------------------

    Copyright (C) 2014 Open Ephys

    ------------------------------------------------------------------

    This program is free software: you can redistribute it and/or modify
    it under the terms of the GNU General Public License as published by
    the Free Software Foundation, either version 3 of the License, or
    (at your option) any later version.

    This program is distributed in the hope that it will be useful,
    but WITHOUT ANY WARRANTY; without even the implied warranty of
    MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
    GNU General Public License for more details.

    You should have received a copy of the GNU General Public License
    along with this program.  If not, see <http://www.gnu.org/licenses/>

*/

var sxycale=7;

var centers =[]; 
var freqphase=[]; 
var ncenters=6;
var text_top_px=365;

var lowest=0;

for (var i = 0; i < ncenters; i++) {
    centers.push([(50+Math.random()*130)*sxycale,(10+Math.random()*60)*sxycale]);
    if (centers[i][1]>lowest){ // align lowest point to text
    	lowest=centers[i][1];
    }
    freqphase.push([1+Math.random()*4,Math.random()*200,0]); // freq,phase,flag for collision detection
    if (Math.random()<0.5){
    freqphase[i][0]=-freqphase[i][0];
    }
}
// align lowest point to text
for (var i = 0; i < ncenters; i++) {
   centers[i][1] = text_top_px+centers[i][1]-lowest;

}


var centers_rot =centers; 

var drawornot =[1,1,1,1,1,1,1]; 
for (var i = 0; i < 1000; i++) {
    drawornot.push(Math.random() <=0.4);
}

var colors = [];
	colors.push('FBD126');
	colors.push('24B7E1');
    	colors.push('24B7E1');
	colors.push('EA6A3F');
	colors.push('B5B5B6');
    	colors.push('B5B5B6');
	colors.push('D6AACD');
	colors.push('7FC244');
    	colors.push('2FB6DF');
    	colors.push('FBD027');
    
    

var connections = new Group();
function generateConnections(paths) {
    var cdraw=0;
    var ccolor=0;
	for (var i = 0, l = centers.length; i < l; i++) {
		for (var j = i - 1; j >= 0; j--) {
		    cdraw=cdraw+1;
            if (drawornot[cdraw]) {
		        ccolor=ccolor+1;
                var n=(i+j+Math.round(Math.random()*10))%7;  
                var n=ccolor%10;
              
            	// Create a Paper.js Path to draw a line into it:
            	var path = new Path();
            	path.strokeColor =  colors[n];
            	path.strokeWidth= 17;
	        path.strokeCap= 'round';
	        path.blendMode= 'multiply';
	
            	path.moveTo(centers[i]);
            	path.lineTo( centers[j]);
                connections.appendTop(path);
                
		}
		}
	}
}

generateConnections(centers);

function onFrame(event) {
if (event.count%2 == 0) {
  var tfactor  =2; // set to ~.1 for debug
for (var i = 0; i < ncenters; i++) {
    var dx=Math.sin(((1/tfactor)*0.01*event.time*freqphase[i][0])+freqphase[i][1]);
    var dy=Math.cos(((1/tfactor)*0.01*event.time*freqphase[i][0])+freqphase[i][1])*0.75;
    centers[i][0]+=2*dx/(tfactor*10);
    centers[i][1]+=2*dy/(tfactor*10);
	
 if( centers[i][0]>860){
   centers[i][0]=860;
}
 if( centers[i][1]>text_top_px){
   centers[i][1]=text_top_px;
 }
if( centers[i][1]>=text_top_px && freqphase[i][2]==0){ // reflect and set flag
    freqphase[i][0]=-freqphase[i][0];
    freqphase[i][2]=1;
}
 if( centers[i][1]<text_top_px-2){ //reset flag
freqphase[i][2]=0;
  }
 if( centers[i][0]<30){
    centers[i][0]=30;
}
 if( centers[i][1]<50){
    centers[i][1]=50;
}

}
    connections.children = [];
    generateConnections(centers);
}
}


</script>
</head>
<body>
<p>
 <canvas id="myCanvas"  style="z-index:2;" resize>
 <div id="logo" style="position:absolute; top:300px; left:100px; z-index:-2; width: 718px; height: 478px;"><img src="oe_text.png"></div>
</p>
</body>
</html>
